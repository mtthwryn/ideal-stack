---
import TitlePage from '@/components/TitlePage'
import BaseLayout from '@/layouts/BaseLayout'
import { siteConfig } from '@/site-config'
import { getGitHubRepos } from '@/utils'
import GithubIcon from '@/components/icons/GithubIcon'
import { SOCIALNETWORKS } from '@/data/links'

// Extract username from GitHub URL
const githubNetwork = SOCIALNETWORKS.find((network) => network.name === 'Github')
const githubUrl = githubNetwork?.url || 'https://github.com/mtthwryn'
const username = githubUrl.split('/').pop() || 'mtthwryn'

const repos = await getGitHubRepos(username)

// Helper function to format dates
function formatDate(dateString: string): string {
	const date = new Date(dateString)
	return date.toLocaleDateString('en-us', {
		year: 'numeric',
		month: 'short',
		day: 'numeric'
	})
}
---

<BaseLayout title='Projects' description={`Projects by ${siteConfig.author}`}>
	<TitlePage title='Projects' />

	<div class='prose prose-stone dark:prose-invert max-w-none'>
		<section class='space-y-6'>
			<p class='text-lg leading-relaxed'>
				Here are some of the projects I've worked on. Each project represents a learning experience
				and a step forward in my development journey.
			</p>

			{
				repos.length > 0 ? (
					<div class='grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mt-8'>
						{repos.map((repo) => (
							<article class='group relative border border-stone-200 dark:border-stone-800 rounded-xl p-6 bg-white dark:bg-stone-900/40 shadow-sm hover:shadow-lg hover:border-stone-300 dark:hover:border-stone-700 transition-all duration-300 flex flex-col gap-5 overflow-hidden'>
								{/* Decorative gradient overlay on hover */}
								<div class='absolute inset-0 bg-gradient-to-br from-stone-50/0 to-stone-100/0 dark:from-stone-800/0 dark:to-stone-900/0 group-hover:from-stone-50/50 group-hover:to-stone-100/30 dark:group-hover:from-stone-800/30 dark:group-hover:to-stone-900/20 transition-all duration-300 pointer-events-none rounded-xl' />

								<div class='relative z-10 flex items-start justify-between gap-3'>
									<div class='flex-1 min-w-0'>
										<h3 class='text-xl font-bold m-0 mb-1'>
											<a
												href={repo.html_url}
												target='_blank'
												rel='noopener noreferrer'
												class='text-stone-900 dark:text-white hover:text-stone-600 dark:hover:text-stone-300 transition-colors inline-block'
											>
												{repo.name}
											</a>
										</h3>
										{repo.archived && (
											<span class='inline-block text-xs px-2 py-0.5 bg-stone-200 dark:bg-stone-700 text-stone-600 dark:text-stone-400 rounded-full font-medium'>
												Archived
											</span>
										)}
									</div>
									<a
										href={repo.html_url}
										target='_blank'
										rel='noopener noreferrer'
										aria-label={`View ${repo.name} on GitHub`}
										class='flex-shrink-0 text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-stone-100 transition-all duration-200 hover:scale-110'
									>
										<GithubIcon />
									</a>
								</div>

								{repo.description && (
									<p class='relative z-10 text-stone-600 dark:text-stone-400 m-0 line-clamp-3 text-sm leading-relaxed'>
										{repo.description}
									</p>
								)}

								{repo.topics.length > 0 && (
									<div class='relative z-10 flex flex-wrap gap-2'>
										{repo.topics.map((topic) => (
											<span class='text-xs px-2.5 py-1 bg-stone-100 dark:bg-stone-800 text-stone-700 dark:text-stone-300 rounded-full font-medium border border-stone-200 dark:border-stone-700'>
												{topic}
											</span>
										))}
									</div>
								)}

								<div class='relative z-10 flex flex-wrap items-center gap-3 text-xs text-stone-500 dark:text-stone-500 pt-3 border-t border-stone-200 dark:border-stone-800'>
									{repo.language && (
										<span class='flex items-center gap-1.5 font-medium'>
											<span class='w-2.5 h-2.5 rounded-full bg-blue-500 shadow-sm' />
											{repo.language}
										</span>
									)}
									{repo.stargazers_count > 0 && (
										<span class='flex items-center gap-1'>
											‚≠ê <span class='font-medium'>{repo.stargazers_count}</span>
										</span>
									)}
									{repo.forks_count > 0 && (
										<span class='flex items-center gap-1'>
											üç¥ <span class='font-medium'>{repo.forks_count}</span>
										</span>
									)}
									{repo.watchers_count > 0 && (
										<span class='flex items-center gap-1'>
											üëÅÔ∏è <span class='font-medium'>{repo.watchers_count}</span>
										</span>
									)}
								</div>

								<div class='relative z-10 flex flex-wrap items-center gap-4 text-xs text-stone-500 dark:text-stone-500 mt-auto'>
									<span class='font-medium'>
										Created: <span class='font-normal'>{formatDate(repo.created_at)}</span>
									</span>
									<span class='font-medium'>
										Updated: <span class='font-normal'>{formatDate(repo.updated_at)}</span>
									</span>
								</div>

								<div class='relative z-10 flex gap-3 pt-3 border-t border-stone-200 dark:border-stone-800'>
									<a
										href={repo.html_url}
										target='_blank'
										rel='noopener noreferrer'
										class='text-sm font-semibold text-stone-700 dark:text-stone-300 hover:text-stone-900 dark:hover:text-white transition-colors flex items-center gap-1 group/link'
									>
										View on GitHub
										<span class='group-hover/link:translate-x-0.5 transition-transform inline-block'>
											‚Üí
										</span>
									</a>
									{repo.homepage && (
										<a
											href={repo.homepage}
											target='_blank'
											rel='noopener noreferrer'
											class='text-sm font-semibold text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-white transition-colors flex items-center gap-1.5 group/link'
										>
											<span>üåê</span>
											<span>Live Demo</span>
										</a>
									)}
								</div>
							</article>
						))}
					</div>
				) : (
					<div class='mt-8'>
						<p class='text-base text-stone-600 dark:text-stone-400 italic'>
							Unable to load projects. Please check your GitHub username or try again later.
						</p>
					</div>
				)
			}
		</section>
	</div>
</BaseLayout>
