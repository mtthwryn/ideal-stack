---
import ListCategories from '@/components/ListCategories'
import ListPosts from '@/components/ListPosts'
import FeaturedPost from '@/components/FeaturedPost'
import TitlePage from '@/components/TitlePage'
import BaseLayout from '@/layouts/BaseLayout'
import { getPosts } from '@/utils'
import { siteConfig } from '@/site-config'
import PostCard from '@/components/PostCard'

const MAX_POSTS = 6 // max number of posts to show on the home page
const allPosts = await getPosts(MAX_POSTS)
const FEATURED_COUNT = 3
const featuredPosts = allPosts.slice(0, FEATURED_COUNT)
const latestPosts = allPosts.slice(FEATURED_COUNT)
---

<BaseLayout title='Home'>
	<TitlePage title='Dev Blog' />
	<!-- Categories Navigation -->
	<ListCategories />

	<!-- Featured Post Section -->
	{
		featuredPosts.length > 0 && (
			<section class='py-2 space-y-6'>
				<div class='flex items-center justify-between'>
					<h2 class='text-2xl md:text-3xl font-bold text-stone-900 dark:text-white'>
						Featured Posts
					</h2>
					<a
						href='/posts'
						class='text-sm font-semibold text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-white transition-colors'
					>
						All Posts →
					</a>
				</div>
				<div class='grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6'>
					{await Promise.all(
						featuredPosts.map(async (post) => {
							const { remarkPluginFrontmatter } = await post.render()
							return (
								<PostCard
									id={post.id}
									data={post.data}
									slug={post.slug}
									readTime={remarkPluginFrontmatter.minutesRead}
								/>
							)
						})
					)}
				</div>
			</section>
		)
	}

	<!-- Latest Posts Section -->
	{
		latestPosts.length > 0 && (
			<section class='py-2 space-y-6'>
				<div class='flex items-center justify-between'>
					<h2 class='text-2xl md:text-3xl font-bold text-stone-900 dark:text-white'>
						Latest Posts
					</h2>
					<a
						href='/posts'
						class='text-sm font-semibold text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-white transition-colors'
					>
						All Posts →
					</a>
				</div>
				<ListPosts posts={latestPosts} />
			</section>
		)
	}
</BaseLayout>

<script>
	import { animate } from 'motion'
	const showAnimations = localStorage.getItem('animations') === 'true'

	if (showAnimations) {
		animate(
			'.title',
			{ y: [80, 0], opacity: [0, 1] },
			{
				duration: 2.5,
				opacity: { duration: 3 },

				offset: [0, 0.55, 0.75]
			}
		)
	}
</script>
