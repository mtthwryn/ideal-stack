---
import ListCategories from '@/components/ListCategories'
import ListPosts from '@/components/ListPosts'
import FeaturedPost from '@/components/FeaturedPost'
import TitlePage from '@/components/TitlePage'
import BaseLayout from '@/layouts/BaseLayout'
import { getPosts } from '@/utils'
import { siteConfig } from '@/site-config'

const MAX_POSTS = 6 // max number of posts to show on the home page
const allPosts = await getPosts(MAX_POSTS)
const featuredPost = allPosts[0]
const latestPosts = allPosts.slice(1)

// Get read time for featured post
let featuredReadTime = '5 min read'
if (featuredPost) {
	const rendered = await featuredPost.render()
	featuredReadTime = rendered.remarkPluginFrontmatter.minutesRead || '5 min read'
}
---

<BaseLayout title='Home'>
	<TitlePage title='Dev Blog' />
	<!-- Categories Navigation -->
	<ListCategories />

	<!-- Featured Post Section -->
	{
		featuredPost && (
			<section class='py-8 space-y-6'>
				<div class='flex items-center justify-between'>
					<h2 class='text-2xl md:text-3xl font-bold text-stone-900 dark:text-white'>
						Featured Post
					</h2>
					<a
						href='/posts'
						class='text-sm font-semibold text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-white transition-colors'
					>
						All Posts →
					</a>
				</div>
				<FeaturedPost post={featuredPost} readTime={featuredReadTime} />
			</section>
		)
	}

	<!-- Latest Posts Section -->
	{
		latestPosts.length > 0 && (
			<section class='py-8 space-y-6'>
				<div class='flex items-center justify-between'>
					<h2 class='text-2xl md:text-3xl font-bold text-stone-900 dark:text-white'>
						Latest Posts
					</h2>
					<a
						href='/posts'
						class='text-sm font-semibold text-stone-600 dark:text-stone-400 hover:text-stone-900 dark:hover:text-white transition-colors'
					>
						All Posts →
					</a>
				</div>
				<ListPosts posts={latestPosts} />
			</section>
		)
	}
</BaseLayout>

<script>
	import { animate } from 'motion'
	const showAnimations = localStorage.getItem('animations') === 'true'

	if (showAnimations) {
		animate(
			'.title',
			{ y: [80, 0], opacity: [0, 1] },
			{
				duration: 2.5,
				opacity: { duration: 3 },

				offset: [0, 0.55, 0.75]
			}
		)
	}
</script>
